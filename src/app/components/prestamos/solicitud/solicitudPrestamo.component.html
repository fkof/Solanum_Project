<div class="container-general">
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
  <p-dialog header="Resumen de Solicitud" [modal]="true" [(visible)]="veResumen" [style]="{'width': '50vw'}">
    <div class="container_solicitud">
      <h2>Monto solicitado</h2>
      <div class="date-box">{{ montoSolicitado }}</div>

      <h2>Cantidad a rebajar por semana</h2>
      <div class="date-box">{{selectedCantidadRebaje?.descripcion }}</div>

      <h2>Motivo</h2>
      <div class="date-box">{{motivo}}</div>
      <p-panel header="AmortizaciÃ³n" [toggleable]="true" (collapsedChange)="abrirCerrarMortizacion($event)">

        <p-table #dt [value]="simulacionAmortizacion" [loading]="loading" [paginator]="true" [rows]="5"
          [rowsPerPageOptions]="[5]" [showCurrentPageReport]="true" scrollHeight="400px"
          [tableStyle]="{ 'min-width': '30rem','max-height': '20rem' }" styleClass="p-datatable-gridlines"
          currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} solicitudes" [scrollable]="true"
          [responsive]="true">

          <ng-template pTemplate="header">
            <tr>
              <th style="width: 80px">
                numeroPago
              </th>
              <th style="min-width: 200px">
                fecha Pago
              </th>
              <th style="min-width: 300px">
                monto Pago
              </th>
              <th style="width: 120px">
                saldo Pendiente
              </th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-amortizacion>
            <tr>
              <td>
                <span class="numero-nomina">
                  {{ amortizacion.numeroPago }}
                </span>
              </td>

              <td> <span class="default-texto"> {{globalHelpers.formatearFechastr( amortizacion.fechaPago )}}</span>
              </td>
              <td> {{ amortizacion.monto }}</td>
              <td> {{ amortizacion.saldoRestante }}</td>

            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <tr>
              <td colspan="5" class="empty-message">
                <div class="empty-state">
                  <i class="pi pi-search empty-icon"></i>
                  <p>No se encontraron Solitudes pendientes.</p>

                </div>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="loadingbody">
            <tr>
              <td colspan="5">
                <div class="loading-state">
                  <i class="pi pi-spin pi-spinner loading-icon"></i>
                  <p>Buscando Solicitudes...</p>
                </div>
              </td>
            </tr>
          </ng-template>
        </p-table>

      </p-panel>
      <div style="display: flex; justify-content: center; padding-top: 20px;">
        <p-button label="Cancelar" icon="pi pi-times" (onClick)="veResumen =false" styleClass="p-button-outlined py-4"
          [style]="{'margin-right':'10px'}"></p-button>

        <p-button label="Aceptar" (onClick)="handleSolcitud()" icon="pi pi-check" [loading]="loading"
          styleClass="p-button-primary py-4" class="w-full mx-12"></p-button>
      </div>

    </div>


  </p-dialog>
  <p-card>
    <ng-template pTemplate="header">
      <div class="card-header">
        <div class="header-content">
          <h2 class="header-title">Mis Prestamos</h2>
          <p class="header-subtitle">Solicita tus prestamos.</p>
        </div>

      </div>
    </ng-template>



    <div class="prestamos-container">

      <div class="search-form">
        <div class="form-grid">
          <div class="form-field">
            <label class="field-label">Cantidad a solicitar</label>
            <p-inputnumber [(ngModel)]="montoSolicitado" inputId="currency-us" mode="currency" currency="USD"
              locale="en-US" />
          </div>
          <div class="form-field">
            <label class="field-label">Cantidad a rebajar por semana</label>
            <p-dropdown [options]="cantidadRebaje" optionLabel="descripcion" [(ngModel)]="selectedCantidadRebaje"
              name="cantidadRebaje"></p-dropdown>

            <!-- <p-dropdown [options]="tipoPermiso" optionLabel="descripcion" optionValue="idTipoPermiso"
              [(ngModel)]="selectedTipoPermiso" name="tipoPermiso"></p-dropdown> -->
          </div>
          <div class="form-field">
            <label class="field-label">Motivo</label>

            <input pInputText type="text" [(ngModel)]="motivo" placeholder="Capture su motivo" class="search-input" />
            <p-message severity="error" size="small" variant="simple">*No se puede capturar "Por motivos personales",
              por favor ingrese especificamente el motivo</p-message>

          </div>
          <div class="form-field" style="align-self: end;">
            <p-button label="Solicitar Prestamo" icon="pi pi-check" [loading]="loading" styleClass="p-button-primary"
              (onClick)="envioSolicitud()" [disabled]="solicitudesPrestamo.length> 0" class="w-full"></p-button>
          </div>
        </div>
      </div>

    </div>
    <!-- Separador -->
    <div class="separator"></div>

    <!-- Tabla de resultados -->

    <div class="results-section">
      <h3 class="results-title">
        <i class="pi pi-list"></i>
        Tus Solicitudes
      </h3>

      <p-table #dt [value]="solicitudesPrestamo" [loading]="loading" [paginator]="true" [rows]="10"
        [rowsPerPageOptions]="[5, 10, 20]" [showCurrentPageReport]="true" [tableStyle]="{ 'min-width': '70rem' }"
        styleClass="p-datatable-gridlines"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} solicitudes" [scrollable]="true"
        [responsive]="true">

        <ng-template pTemplate="header">
          <tr>
            <th pSortableColumn="idSolicitud" style="width: 80px">
              ID <p-sortIcon field="idSolicitud"></p-sortIcon>
            </th>
            <th pSortableColumn="montoSolicitado" style="min-width: 200px">
              Monto Solicitado <p-sortIcon field="montoSolicitado"></p-sortIcon>
            </th>
            <th pSortableColumn="cantidadRebaje" style="min-width: 200px">
              Descuento por semana <p-sortIcon field="cantidadRebaje"></p-sortIcon>
            </th>
            <th pSortableColumn="fechaPermiso" style="min-width: 300px">
              Fecha Creacion <p-sortIcon field="fechaPermiso"></p-sortIcon>
            </th>
            <th pSortableColumn="estatus" style="width: 120px">
              Estado <p-sortIcon field="estatus"></p-sortIcon>
            </th>
            <th style="width: 140px">Acciones</th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-solicitud>
          <tr>
            <td>
              <span class="numero-nomina">
                {{ solicitud.idSolicitud }}
              </span>
            </td>

            <td> <span class="nombre-empleado"> {{ solicitud.montoSolicitado }} </span></td>
            <td> <span class="default-texto"> {{ solicitud.cantidadRebaje }}</span></td>
            <td> <span class="default-texto"> {{globalHelpers.formatearFechastr( solicitud.fechaCreacion )}}</span></td>
            <td> <p-tag [value]="solicitud.estatus" [severity]="globalHelpers.getSeverityStatus(solicitud.estatus)" />
            </td>
            <td>
              <div class="action-buttons">

                <p-button icon="pi pi-times" (onClick)="preguntaCancelarSolicitud(solicitud)"
                  styleClass="p-button-rounded p-button-text p-button-danger delete-btn"
                  [pTooltip]="'Cancelar Solicitud'" tooltipPosition="top"></p-button>
              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="7" class="empty-message">
              <div class="empty-state">
                <i class="pi pi-search empty-icon"></i>
                <p>No se encontraron Solitudes pendientes.</p>

              </div>
            </td>
          </tr>
        </ng-template>

        <ng-template pTemplate="loadingbody">
          <tr>
            <td colspan="7">
              <div class="loading-state">
                <i class="pi pi-spin pi-spinner loading-icon"></i>
                <p>Buscando Solicitudes...</p>
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>

    </div>





  </p-card>
</div>